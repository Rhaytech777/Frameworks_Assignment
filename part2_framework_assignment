# 1. Identify columns with many missing values
missing_percent = (df.isnull().sum() / len(df)) * 100
missing_report = missing_percent.sort_values(ascending=False)
print("Columns with highest missing values (%):")
print(missing_report.head(10), "\n")
# 2. Handle missing values
# Drop columns with more than 80% missing data
cols_to_drop = missing_report[missing_report > 80].index
df_cleaned = df.drop(columns=cols_to_drop)

print("Dropped columns with more than 80% missing values.\n")

# Fill remaining missing text fields
text_cols = ["title", "abstract", "journal"]
for col in text_cols:
    if col in df_cleaned.columns:
        df_cleaned[col] = df_cleaned[col].fillna("Not Available")

# Fill missing publish_time with mode
if "publish_time" in df_cleaned.columns:
    df_cleaned["publish_time"] = df_cleaned["publish_time"].fillna(df_cleaned["publish_time"].mode()[0])

print("Missing values filled.\n")

# 3. Convert publish_time to datetime
df_cleaned["publish_time"] = pd.to_datetime(df_cleaned["publish_time"], errors="coerce")

# Extract publication year
df_cleaned["pub_year"] = df_cleaned["publish_time"].dt.year

print("Converted publish_time to datetime and extracted publication year.\n")
# 4. Create new column: abstract word count
df_cleaned["abstract_word_count"] = df_cleaned["abstract"].apply(lambda x: len(str(x).split()))

print("Created abstract_word_count column.\n")
# 5. Save cleaned dataset
df_cleaned.to_csv("metadata_cleaned.csv", index=False)

print("Cleaned dataset saved as metadata_cleaned.csv")
